<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Promises</title>
  </head>
  <body>
    <script>
      function makePizza(toppings = []) {
        return new Promise(function (resolve, reject) {
          // reject if people try with pineapple
          if (toppings.includes("pineapple")) {
            reject("seriously, Get out 🍍");
          }

          const amountOfTimeToBake = 500 + toppings.length * 200;

          // wait 1 sec for pizza to cook
          setTimeout(function () {
            // when you are ready, you can resolve this promise;
            resolve(
              `Here is your pizza 🍕 with the toppings ${toppings.join(" ")}`
            );
          }, amountOfTimeToBake);
          // if something went wrong, we can reject this promise;
        });
        return pizzaPromise;
      }

      // const pizza = makePizza();
      // console.log(pizza);

      const pepperoniPromise = makePizza(["pepperoni"]);
      // const canadianPromise = makePizza(["pepperoni", "mashrooms", "onions"]);

      console.log("Making pizza for you", pepperoniPromise);

      // console.log("Starting");
      // pepperoniPromise.then(function (pizza) {
      //   console.log("Ahh got it.");

      //   console.log(pizza);
      // });
      // console.log("Ending");

      // making pizza one after another ( sequentialy ) promise

      // makePizza(["pepperoni"])
      //   .then(function (pizza) {
      //     console.log(pizza);
      //     return makePizza(["onions", "mashrooms", "carrots"]);
      //   })
      //   .then(function (pizza) {
      //     console.log(pizza);
      //     return makePizza(["chicken", "cheese", "onions"]);
      //   })
      //   .then(function (pizza) {
      //     console.log(pizza);
      //     return makePizza([]);
      //   })
      //   .then(function (pizza) {
      //     console.log(pizza);
      //     return makePizza([
      //       "one",
      //       "two",
      //       "three",
      //       "four",
      //       "five",
      //       "six",
      //       "seven",
      //       "eight",
      //       "nine",
      //       "ten",
      //     ]);
      //   })
      //   .then(function (pizza) {
      //     console.log("All done,Here is your last pizza ready for you.");
      //     console.log(pizza);
      //   });

      // making pizza concurrently ( everyting at one time)
      const pizzaPromise1 = makePizza(["onions", "mashrooms", "carrots"]);
      const pizzaPromise2 = makePizza(["chicken", "cheese", "onions"]);
      const pizzaPromise3 = makePizza([
        "one",
        "two",
        "three",
        "four",
        "five",
        "six",
        "seven",
        "eight",
        "nine",
        "ten",
      ]);

      // promise all - does not particularly wait for single one, brings everything once
      const gettingPizza = Promise.all([
        pizzaPromise1,
        pizzaPromise2,
        pizzaPromise3,
      ]);

      // gettingPizza.then(function ([hottie, chicken, largePizz]) {
      //   // const [hottie, chicken, largePizz] = pizzas;
      //   console.log(hottie, chicken, largePizz);
      // });

      // promise race - brings the fastest one first then wait for others
      // const firstPizza = Promise.race([
      //   pizzaPromise1,
      //   pizzaPromise2,
      //   pizzaPromise3,
      // ]);

      // firstPizza.then((pizza) => {
      //   console.log(`You must be hungrey, here is the first one ready`);
      //   console.log(pizza);
      // });

      // error handling with catch

      function handleError(err) {
        console.log("Oh Nooooo!!!");
        console.log(err);
      }
      makePizza(["chesse", "pineapple"])
        .then((pizza) => {
          console.log(pizza);
        })
        .catch(handleError);

      const p1 = makePizza(["coconut"]);
      const p2 = makePizza(["pineapple"]);

      const dinnerPizza = Promise.allSettled([p1, p2]);

      dinnerPizza.then((pizza) => console.log(pizza)).catch(handleError);
    </script>
  </body>
</html>
